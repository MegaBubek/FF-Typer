<!DOCTYPE html><html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FF-Typer</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; color: #333; }
    .container { max-width: 800px; margin: auto; padding: 20px; }
    .hidden { display: none; }
    .match { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 8px; background-color: #fff; }
    .match input { width: 50px; text-align: center; }
    .match button { margin-left: 10px; }
    .match-list { margin-top: 20px; }
    .match-typers { font-size: 0.9em; color: #555; margin-top: 5px; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .queue-selector { margin-top: 20px; }
    .queue-selector select { padding: 5px; font-size: 1em; }
    .logout-btn { background-color: #e74c3c; color: #fff; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="container">
    <div id="login-view">
      <h2>Logowanie</h2>
      <input type="email" id="login-email" placeholder="Email" /><br><br>
      <input type="password" id="login-password" placeholder="Hasło" /><br><br>
      <button onclick="login()">Zaloguj się</button>
      <p>Nie masz konta? <a href="#" onclick="showRegister()">Zarejestruj się</a></p>
    </div><div id="register-view" class="hidden">
  <h2>Rejestracja</h2>
  <input type="text" id="register-nickname" placeholder="Nick" /><br><br>
  <input type="email" id="register-email" placeholder="Email" /><br><br>
  <input type="password" id="register-password" placeholder="Hasło" /><br><br>
  <button onclick="register()">Zarejestruj się</button>
  <p>Masz już konto? <a href="#" onclick="showLogin()">Zaloguj się</a></p>
</div>

<div id="main-view" class="hidden">
  <div class="header">
    <h2>FF-Typer</h2>
    <button class="logout-btn" onclick="logout()">Wyloguj</button>
  </div>

  <div class="queue-selector">
    <label for="queue-select">Wybierz kolejkę:</label>
    <select id="queue-select" onchange="renderMatches()"></select>
  </div>

  <div id="match-list" class="match-list"></div>
</div>

  </div>  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDIhMW94ZY7_7w8yttJSHAwmCPR3bSTsHw",
      authDomain: "ff-typer.firebaseapp.com",
      projectId: "ff-typer",
      storageBucket: "ff-typer.appspot.com",
      messagingSenderId: "22978913956",
      appId: "1:22978913956:web:6e6113180e48142d952831",
      measurementId: "G-2BFZY3PWFZ"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    let currentQueue = 1;

    const loginView = document.getElementById("login-view");
    const registerView = document.getElementById("register-view");
    const mainView = document.getElementById("main-view");
    const queueSelect = document.getElementById("queue-select");
    const matchList = document.getElementById("match-list");

    function showLogin() {
      loginView.classList.remove("hidden");
      registerView.classList.add("hidden");
    }

    function showRegister() {
      registerView.classList.remove("hidden");
      loginView.classList.add("hidden");
    }

    function showMain() {
      loginView.classList.add("hidden");
      registerView.classList.add("hidden");
      mainView.classList.remove("hidden");
    }

    function login() {
      const email = document.getElementById("login-email").value;
      const password = document.getElementById("login-password").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => location.reload())
        .catch(error => alert(error.message));
    }

    function register() {
      const email = document.getElementById("register-email").value;
      const password = document.getElementById("register-password").value;
      const nickname = document.getElementById("register-nickname").value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(cred => {
          return db.collection("users").doc(cred.user.uid).set({ nickname });
        })
        .then(() => location.reload())
        .catch(error => alert(error.message));
    }

    function logout() {
      auth.signOut().then(() => location.reload());
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        db.collection("users").doc(user.uid).get().then(doc => {
          if (!doc.exists) logout(); // Brak nicku = błąd = wyloguj
          else {
            currentUser.nickname = doc.data().nickname;
            initQueueSelect();
            showMain();
            renderMatches();
          }
        });
      } else {
        showLogin();
      }
    });

    function initQueueSelect() {
      for (let i = 1; i <= 34; i++) {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = `Kolejka ${i}`;
        queueSelect.appendChild(opt);
      }
    }

    function renderMatches() {
      currentQueue = parseInt(queueSelect.value);
      matchList.innerHTML = "";
      db.collection("matches").where("kolejka", "==", currentQueue).get().then(snapshot => {
        snapshot.forEach(doc => {
          const match = doc.data();
          const div = document.createElement("div");
          div.className = "match";
          div.innerHTML = `
            <strong>${match.gospodarz} vs ${match.gosc}</strong><br>
            <input type="number" id="g${doc.id}" placeholder="Gosp." min="0"> :
            <input type="number" id="o${doc.id}" placeholder="Gość" min="0">
            <button onclick="submitTip('${doc.id}')">Zapisz</button>
            <div class="match-typers" id="typers-${doc.id}"></div>
          `;
          matchList.appendChild(div);

          db.collection("typy").where("meczId", "==", doc.id).get().then(tsnap => {
            const typersDiv = document.getElementById(`typers-${doc.id}`);
            tsnap.forEach(tdoc => {
              const t = tdoc.data();
              const when = new Date(t.timestamp?.seconds * 1000).toLocaleString();
              typersDiv.innerHTML += `<div><strong>${t.user}</strong>: ${t.gospodarz} : ${t.gosc} (${when})</div>`;
            });
          });
        });
      });
    }

    function submitTip(matchId) {
      const g = document.getElementById(`g${matchId}`).value;
      const o = document.getElementById(`o${matchId}`).value;
      if (g === "" || o === "") return alert("Podaj wynik!");
      db.collection("typy").add({
        meczId: matchId,
        user: currentUser.nickname,
        gospodarz: parseInt(g),
        gosc: parseInt(o),
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => renderMatches());
    }
  </script></body>
</html>
