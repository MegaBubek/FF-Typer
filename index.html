<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FF-Typer</title>
</head>
<body style="font-family: sans-serif; padding: 30px;">
  <h1>FF-Typer</h1>

  <!-- Formularz do obstawiania -->
  <form id="prediction-form" style="margin-bottom: 40px;">
    <label>Użytkownik: <input type="text" id="user" required /></label><br><br>
    <label>Mecz (np. LECH - LEGIA): <input type="text" id="match" required /></label><br><br>
    <label>Wynik gospodarzy: <input type="number" id="homeScore" required /></label><br><br>
    <label>Wynik gości: <input type="number" id="awayScore" required /></label><br><br>
    <button type="submit">Zapisz typ</button>
  </form>

  <!-- Sekcja pokazująca wszystkie typy -->
  <div id="all-predictions" style="margin-top: 50px; padding: 20px;">
    <h2>Wszystkie obstawione mecze</h2>
    <p>Wczytywanie danych...</p>
  </div>

  <!-- Firebase SDK + JS -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDIhMW94ZY7_7w8yttJSHAwmCPR3bSTsHw",
      authDomain: "ff-typer.firebaseapp.com",
      projectId: "ff-typer",
      storageBucket: "ff-typer.appspot.com",
      messagingSenderId: "22978913956",
      appId: "1:22978913956:web:6e6113180e48142d952831",
      measurementId: "G-2BFZY3PWFZ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ZAPISYWANIE TYPU
    const form = document.getElementById("prediction-form");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const user = document.getElementById("user").value.trim();
      const matchId = document.getElementById("match").value.trim();
      const homeScore = parseInt(document.getElementById("homeScore").value);
      const awayScore = parseInt(document.getElementById("awayScore").value);

      if (!user || !matchId || isNaN(homeScore) || isNaN(awayScore)) {
        alert("Wypełnij poprawnie wszystkie pola.");
        return;
      }

      try {
        await addDoc(collection(db, "predictions"), {
          user,
          matchId,
          homeScore,
          awayScore,
          timestamp: serverTimestamp()
        });
        alert("Typ zapisany!");
        form.reset();
        loadAllPredictions(); // Odśwież dane po zapisie
      } catch (error) {
        console.error("Błąd zapisu:", error);
        alert("Błąd zapisu typu.");
      }
    });

    // WCZYTYWANIE TYPOW
    async function loadAllPredictions() {
      const querySnapshot = await getDocs(collection(db, "predictions"));
      const container = document.getElementById("all-predictions");

      let html = `
        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
          <thead>
            <tr style="background-color: #f0f0f0;">
              <th style="padding: 10px; border: 1px solid #ccc;">Użytkownik</th>
              <th style="padding: 10px; border: 1px solid #ccc;">Mecz</th>
              <th style="padding: 10px; border: 1px solid #ccc;">Typ</th>
              <th style="padding: 10px; border: 1px solid #ccc;">Data</th>
            </tr>
          </thead>
          <tbody>
      `;

      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const date = data.timestamp?.seconds
          ? new Date(data.timestamp.seconds * 1000).toLocaleString("pl-PL")
          : "-";

        html += `
          <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">${data.user || "?"}</td>
            <td style="padding: 8px; border: 1px solid #ccc;">${data.matchId || "?"}</td>
            <td style="padding: 8px; border: 1px solid #ccc;">${data.homeScore}:${data.awayScore}</td>
            <td style="padding: 8px; border: 1px solid #ccc;">${date}</td>
          </tr>
        `;
      });

      html += `</tbody></table>`;
      container.innerHTML = `
        <h2>Wszystkie obstawione mecze</h2>
        ${querySnapshot.empty ? "<p>Brak obstawień.</p>" : html}
      `;
    }

    loadAllPredictions();
  </script>
</body>
</html>
