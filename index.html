<!DOCTYPE html><html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FF-Typer</title>
</head>
<body style="font-family: sans-serif; max-width: 700px; margin: auto; padding: 20px;">
  <h1>FF-Typer</h1>  <!-- Rejestracja / Logowanie -->  <div id="auth-section">
    <h2>Rejestracja / Logowanie</h2>
    <input type="email" id="email" placeholder="Email" style="padding: 8px; width: 100%; margin-bottom: 10px;" />
    <input type="password" id="password" placeholder="Hasło" style="padding: 8px; width: 100%; margin-bottom: 10px;" />
    <button id="registerBtn" style="padding: 10px; width: 49%;">Zarejestruj się</button>
    <button id="loginBtn" style="padding: 10px; width: 49%;">Zaloguj się</button>
    <p id="auth-msg" style="color: green;"></p>
  </div>  <!-- Formularz obstawiania meczu -->  <div id="typer-section" style="display: none;">
    <h2>Obstaw mecz</h2>
    <input type="text" id="matchId" placeholder="Nazwa meczu (np. Legia - Lech)" style="padding: 8px; width: 100%; margin-bottom: 10px;" />
    <input type="number" id="homeScore" placeholder="Gospodarze" style="padding: 8px; width: 49%; margin-bottom: 10px;" />
    <input type="number" id="awayScore" placeholder="Goście" style="padding: 8px; width: 49%; margin-bottom: 10px;" />
    <button onclick="submitPrediction()" style="padding: 10px; width: 100%;">Zapisz typ</button>
    <p id="submit-msg" style="color: green;"></p>
  </div>  <!-- Sekcja pokazująca wszystkie typy -->  <div id="all-predictions" style="margin-top: 50px; padding: 20px;">
    <h2>Wszystkie obstawione mecze</h2>
    <p>Wczytywanie danych...</p>
  </div>  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDIhMW94ZY7_7w8yttJSHAwmCPR3bSTsHw",
      authDomain: "ff-typer.firebaseapp.com",
      projectId: "ff-typer",
      storageBucket: "ff-typer.appspot.com",
      messagingSenderId: "22978913956",
      appId: "1:22978913956:web:6e6113180e48142d952831",
      measurementId: "G-2BFZY3PWFZ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth();

    const authSection = document.getElementById("auth-section");
    const typerSection = document.getElementById("typer-section");
    const authMsg = document.getElementById("auth-msg");

    document.getElementById("registerBtn").onclick = async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      try {
        await createUserWithEmailAndPassword(auth, email, password);
        authMsg.textContent = "Zarejestrowano pomyślnie.";
      } catch (error) {
        authMsg.textContent = "Błąd: " + error.message;
      }
    };

    document.getElementById("loginBtn").onclick = async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        authMsg.textContent = "Zalogowano pomyślnie.";
      } catch (error) {
        authMsg.textContent = "Błąd: " + error.message;
      }
    };

    onAuthStateChanged(auth, (user) => {
      if (user) {
        authSection.style.display = "none";
        typerSection.style.display = "block";
        loadAllPredictions();
      } else {
        authSection.style.display = "block";
        typerSection.style.display = "none";
      }
    });

    async function submitPrediction() {
      const matchId = document.getElementById("matchId").value;
      const homeScore = parseInt(document.getElementById("homeScore").value);
      const awayScore = parseInt(document.getElementById("awayScore").value);
      const user = auth.currentUser;
      const msg = document.getElementById("submit-msg");

      if (!user) {
        msg.textContent = "Musisz być zalogowany.";
        return;
      }

      try {
        await addDoc(collection(db, "predictions"), {
          user: user.email,
          matchId,
          homeScore,
          awayScore,
          timestamp: serverTimestamp()
        });
        msg.textContent = "Zapisano typ.";
        loadAllPredictions();
      } catch (e) {
        msg.textContent = "Błąd zapisu: " + e.message;
      }
    }

    async function loadAllPredictions() {
      const querySnapshot = await getDocs(collection(db, "predictions"));
      const container = document.getElementById("all-predictions");

      let html = `
        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
          <thead>
            <tr style="background-color: #f0f0f0;">
              <th style="padding: 10px; border: 1px solid #ccc;">Użytkownik</th>
              <th style="padding: 10px; border: 1px solid #ccc;">Mecz</th>
              <th style="padding: 10px; border: 1px solid #ccc;">Typ</th>
              <th style="padding: 10px; border: 1px solid #ccc;">Data</th>
            </tr>
          </thead>
          <tbody>
      `;

      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const date = data.timestamp?.seconds
          ? new Date(data.timestamp.seconds * 1000).toLocaleString("pl-PL")
          : "-";

        html += `
          <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">${data.user || "?"}</td>
            <td style="padding: 8px; border: 1px solid #ccc;">${data.matchId || "?"}</td>
            <td style="padding: 8px; border: 1px solid #ccc;">${data.homeScore}:${data.awayScore}</td>
            <td style="padding: 8px; border: 1px solid #ccc;">${date}</td>
          </tr>
        `;
      });

      html += `</tbody></table>`;
      container.innerHTML = `
        <h2>Wszystkie obstawione mecze</h2>
        ${querySnapshot.empty ? "<p>Brak obstawień.</p>" : html}
      `;
    }
  </script></body>
</html>
